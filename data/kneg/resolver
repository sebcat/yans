#!/usr/bin/env yans
Store = require"svcs.store"
Resolver = require"svcs.resolver"
YCFG = require"ycfg"

msgbuf = yans.ycl.msgbuf()
store = Store:new{path=YCFG.SVC_STORE, msgbuf = msgbuf}
resolver = Resolver:new{path=YCFG.SVC_RESOLVER, store=store, msgbuf=msgbuf}

yans.util.sandbox() -- enter sandbox

-- enter the YANS_ID store, if any, or create a new one
local id = store:enter(os.getenv("YANS_ID"))
print("STORE:", id)

resolver:resolve("trololo.gz", "www.svd.se www.aftonbladet.se www.reddit.com")
for line in resolver:get_result_stream("trololo.gz"):lines() do
  print(line)
end

resolver:resolve("trololo.gz", {"niagara.se", "boston.com", "example.com"})
for line in resolver:get_result_stream("trololo.gz"):lines() do
  print(line)
end

