worker_processes 1;
worker_rlimit_nofile 16384;
events {
  worker_connections 8192;
}

http {
  include       mime.types;
  default_type  application/octet-stream;
  server_tokens off;

  scgi_cache_path /var/cache/nginx keys_zone=mycache:10m
      levels=1:2 inactive=60s max_size=100m;

  server {
    listen                 [::]:80;
    listen                 80;
    server_name            localhost;
    error_page             500 502 503 504  /50x.html;
    access_log             /var/log/nginx/access.log.gz combined gzip;
    error_log              /var/log/nginx/error.log;

    location /a1/sysinfo {
      include              scgi_params;
      scgi_cache           mycache;
      scgi_cache_key       localhost:sysinfoapi$request_uri;
      scgi_cache_valid     200 5s;
      scgi_cache_lock      on;
      scgi_cache_use_stale updating;
      scgi_pass            unix:/var/yans/sysinfoapi/sysinfoapi.sock;
    }

    location /a1 {
      include              scgi_params;
      scgi_cache           mycache;
      scgi_cache_key       localhost:yansapi$request_uri;
      scgi_cache_valid     200 1s;
      scgi_cache_lock      on;
      scgi_cache_use_stale updating;
      scgi_pass            unix:/var/yans/yansapi.sock;
    }

    location / {
      sendfile      on;
      tcp_nopush    on;
      root          /usr/local/share/yans-fe;
      index         index.html index.htm;
    }
  }
}
